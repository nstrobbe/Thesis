\chapter{Event generation, simulation and reconstruction \label{chap:event_generation}}

\textcolor{red}{Outline to be finalized}

\section{What is an ``event''? \label{sec:event}}

% add picture of CMS event display
% add picture of hadronization etc for event

\section{Event generation \label{sec:event_generation}}

% add info on Madgraph, pythia, jet matching etc

\subsection{Matrix element generators}

\subsection{Parton shower and hadronization}

\subsection{Jet matching}


\section{Event simulation \label{sec:event_simulation}}

\subsection{CMS Full Simulation using Geant4 \label{subsec:fullsim}}

% add some info on how this is done, particle interaction with matter, ionization, 
% how it deals with long lived particles?

\subsection{CMS Fast Simulation \label{subsec:fastsim}}

% explain what approximations are made, why it is necessery, especially in SUSY searches

\section{Event reconstruction \label{sec:event_reconstruction}}

% Add subsection on each object with all the object definitions we use

% We select events with at least one interaction vertex, associated with at least 4 charged-particle
% tracks, that lies within 24~cm of the origin of the CMS coordinate system along the beam direction
% and 2~cm from the origin in the plane transverse to the beam. Owing to the high luminosity of the
% LHC, hard scattering events are typically accompanied by many additional events arising from the
% multiple proton-proton interactions that occur when the proton bunches cross.  The overlapping of
% events is referred to as pileup.  The primary vertex is identified as the vertex with the highest
% value of the $\sum \pt^2$ of the associated tracks.  Detector- and beam-related cleaning algorithms
% are used to remove events with detector noise that mimic events with high energy and large imbalance
% in transverse momentum.  


 

\subsection{Particle Flow technique \label{sec:event_reco_pf}}

% CMS reconstructs events using the particle flow (PF) method~\cite{PF}, which reconstructs particles
% (PF candidates) by combining information from the inner tracker, the calorimeters, and the muon
% system.  Each PF candidate is a ssigned to one of five object categories: muons, electrons, photons,
% charged hadrons, and neutral hadrons.  Contamination from pileup events is reduced by discarding
% charged PF candidates that are incompatible with having originated from the primary
% vertex~\cite{CMS-PAS-JME-14-001}.   The average pileup energy due to neutral hadrons is computed
% event-by-event and subtracted from the energy when computing lepton isolation and jet energy.  The
% energy subtracted is  the average pileup energy per unit area (in $\Delta\eta \times \Delta\phi$)
% times the jet area~\cite{Fastjet1, Fastjet2}.

\subsection{Object identification}

The event selection is an integral part of any physics analysis. It determines which events are
used, and thus what processes contribute to the data sample. This in turn drives how the
backgrounds are estimated, what the sensitivity will be, et cetera. 
An event selection is most easily described in terms of particles, e.g. two electrons, no muons, at
least four jets, as this is the closest to how we think about a given process.  
The particle flow technique is very compatible with this approach, given that it already
reconstructs particles out of the detector hits. 
However, a more thorough selection of the PF objects is needed in order to ensure that their
behaviour is understood, and to ensure that the selected events are not dominated by
misidentified particles, or detector artefacts. 
The physics object groups (POG's) within the CMS Collaboration are in charge of providing general
recommendations on how to define each object. 
In the following paragraphs all the standard objects that will be used in the razor boost analysis
will be discussed.

% 
% Missing transverse energy, which is used in the calculation of the razor variable $\mr$, is 
% defined to be the negative sum of the transverse momenta of all the particle flow objects in an
% event.  Loosely identified and isolated electrons with $\pt > 5$~\GeV and $|\eta| < 2.5$ and muons
% with $\pt > 5$\GeV and $|\eta| < 2.4$ are used both to suppress backgrounds in our signal region and
% in the definition of the control regions.  A tight definition of isolated leptons (electrons with
% $\pt > 10$~\GeV and $|\eta| < 2.5$ and muons with $\pt > 10$~\GeV and $|\eta| < 2.4$) defines a
% control region enriched in $\cPZ \rightarrow \ell \ell $ events, from which we estimate the
% systematic uncertainty in the predicted number of $\cPZ \rightarrow \nu \nu$ events in the signal
% region. Any electron candidates with $1.44 < |\eta| < 1.57$ are rejected since the transition region
% between barrel and endcap calorimeters is less well-instrumented.
% In order to suppress the decays of taus and other leptons that fail the loose selection, events that
% have isolated tracks with $\pt > 10$\GeV and track-primary vertex distance along the beam direction
% $dz < 0.05$ are rejected.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{event_objects.tex}


\subsection{Event Cleaning \label{sec:event_cleaning}}

The full CMS data taking and event reconstruction proces is very intricate. Every now and then a
subdetector might not have behaved properly, or a reconstruction algorithm could have failed. 
Events affected by such failures need to be removed from the selection, as they can for example
create artificially high missing transverse momentum.
The following cleaning filters are applied:

\begin{itemize}
\item The {\tt EcalDeadCellTriggerPrimitiveFilter}, which removes events where dead cells in the
ECAL produce anomalous activity.
\item The {\tt hcalLaserEventFilter}, which removes events where the HCAL laser produces anomalous
activity.
\item The {\tt hcalLaserEventFilter2012}, 
\item The {\tt trackingFailureFilter}, which removes events where the tracking algorithm does not
perform properly.
\item The {\tt CSCTightHaloFilter}, which removes events contaminated by beam halo.
\item The {\tt HBHENoiseFilter}, which removes events featuring large hadronic calorimeter noise.
\item The {\tt eeBadScFilter}, which removes events featuring high amplitude anomalous pulses due
to bad ECAL super-crystals.
\item The {\tt trkPOGFilters}, which remove events due to track reconstruction anomalies, such as
events with partly aborted track reconstruction and events affected by the Strip Tracker coherent
noise.
\item The {\tt primaryVertexFilter}, which removes events that do not have a good primary vertex.
\item The {\tt noscrapingFilter}, which removes events with a large multiplicity of low quality
tracks.
\end{itemize}

More details on these filters can be found in Ref.~\cite{metfilters}. The {\tt CSCTightHaloFilter}
and {\tt HBHENoiseFilter} filters are not applied for simulated samples that are
passed through the fast CMS detector simulation because the necessary input collections are
not produced.

In addition to the standard filters listed above, we also use an extra cleaning selection designed
to remove events with spurious HCAL noise originating in the Hadron Outer Calorimeter (HO). 
Energy deposits in the HO are included in the computation of the missing transverse momentum using 
the particle flow algorithm (PFMET), but are not included in the missing transverse energy obtained
from calorimeter information only (CaloMET). 
A selection requiring no substantial discrepancy between PFMET and CaloMET is thus effective at
reducing the contribution of these noisy events. 

We reject events in which the PFMET vector $\VEtmiss(\textrm{PF})$ is flipped with
respect to the CaloMET vector $\VEtmiss(\textrm{CALO})$. 
To accomplish this we compute the absolute value of the difference in polar angle,
 $|\Delta\phi_{\textrm{PF,CALO}}|$, taken in the range $[0,2\pi[$, and defined as
\begin{align}
|\Delta\phi_{\textrm{PF,CALO}}| &= \min \left ( \phi^{\textrm{PF}} - \phi^{\textrm{CALO}},   2\pi -
\phi^{\textrm{PF}} + \phi^{\textrm{CALO}} \right) ,\\
&\textrm{with } \phi^{\textrm{PF}} = \textrm{arctan} \left( \frac{\ETm(\textrm{PF})|_y}
{\ETm(\textrm{PF})|_x} \right) , \\
&\textrm{and } \phi^{\textrm{CALO}} = \textrm{arctan}\left( \frac{\ETm(\textrm{CALO})|_y}
{\ETm(\textrm{CALO})|_x} \right) .
\end{align}
Events for which $|\Delta\phi_{\textrm{PF,CALO}}|$ falls in a 1 radian window centred around $\pi$
are removed. 
\begin{equation}
\bigl| |\Delta\phi_{\textrm{PF,CALO}}| - \pi \bigr| < 1
\label{eqn:dphicut}
\end{equation}


\subsection{Event reweighting \label{sec:event_reweighting}}

The generation and simulation of events are tuned to mimic the data. However, the complete data
taking conditions, in particular the pileup profile, are not fully known before data
taking starts. It is thus impossible to mimic the data in all aspects. 
In addition to this, the event generation itself is also not perfect. For example, event generators
can only compute physics processes up to maximally NLO precision, whereas data contains all orders. 

To correct for some of these imperfections, event reweighting prescriptions have been developed. 
In the next subsections I will cover the reweightings that correct for mismodelling of the pileup
distribution, the initial state radiation (ISR), and the top quark \pt distribution for the
$t\bar{t}$ simulation.

\input{event_reweighting.tex}
