\chapter[Event generation, simulation, reconstruction]{Event generation, simulation and
reconstruction \label{chap:event_generation}}

In the previous two chapters I discussed how $\Pp\Pp$ collisions are produced by the LHC, and
how they are detected by CMS. This chapter will elaborate on the different
steps needed to actually use the collisions for physics analysis. 
First I will explain more details about the collisions, or \textit{events}, themselves. I will
discuss the separate components an event consists of, as well as touch upon how events are described
mathematically. 

In order to understand what we observe in the data, which might contain signals of new physics, it
is important to know how Standard Model processes will appear in the detector. To achieve this we
generate those processes using Monte Carlo generation techniques, incorporating everything that is
known about how the Standard Model works. The principal options that are available to generate
events will be discussed in Section~\ref{sec:event_generation}. 
For each generated collision, we obtain a set of final state particles according to the specified
physics process. This could for example be the particles that result from the production and decay
of a top quark. 
At this stage we do not know yet how these particles would interact with the detector. That is
taken care of in a next step by the event simulation, as explained in
Section~\ref{sec:event_simulation}. An event simulator mimics how a particle, e.g. an electron,
would interact with all the different detector layers, and stores the response of the detector in
the same format as the actual detector data. 

At this point the simulated data and the real data are very similar, but are stored in a raw format,
containing detector hits and energy depositions, rather than physics objects. This format is hard to
use for further analysis. The final step will thus be to perform the event reconstruction. The
purpose of event reconstruction is to convert the raw detector information, be it real or simulated,
into physical objects, such as electrons, muons, photons, charged or neutral hadrons. Each of those
objects comes with a set of defining variables, which can be very basic (e.g. \pt, $\eta$ or $\phi$)
or more complex (e.g. shower shape). The different algorithms and techniques that are used within
CMS for this purpose are detailed in Section~\ref{sec:event_reconstruction}. 

\section{What is an ``event''? \label{sec:event}}

\input{event_what_is_an_event.tex}


\section{Event generation \label{sec:event_generation}}

\input{event_generation.tex}


\section{Event simulation \label{sec:event_simulation}}

\input{event_simulation.tex}


\section{Event reconstruction \label{sec:event_reconstruction}}

\input{event_reconstruction.tex}


\subsection{Physics object identification \label{sec:event_objects}}

The event selection is an integral part of any physics analysis. It determines which events are
used, and thus what processes contribute to the data sample. This in turn drives how the
backgrounds are estimated, what the sensitivity will be, et cetera. 
An event selection is most easily described in terms of particles, e.g. two electrons, no muons, at
least four jets, as this is the closest to how we think about a given process.  
The particle flow technique described in the previous section is very compatible with this approach,
given that it reconstructs a fully consistent set of identified particles out of the detector hits. 
However, a more thorough selection of the PF objects is needed in order to ensure that their
behaviour is understood, and to ensure that the selected events are not dominated by
misidentified particles, or detector artefacts. 
The physics object groups (POG's) within the CMS Collaboration are in charge of providing general
recommendations on how to define each object. These recommendations are based on extensive studies,
and are applicable for most analyses, thus reducing the workload for the analysis teams.
In the following paragraphs all the standard objects that will be used in the razor boost analysis
are discussed.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{event_objects.tex}


\subsection{Event cleaning \label{sec:event_cleaning}}

The full CMS data taking and event reconstruction proces is very intricate. Every now and then a
subdetector might not have behaved properly, or a reconstruction algorithm could have failed. 
Events affected by such failures need to be removed from the selection, as they can for example
create artificially high missing transverse momentum.
The following cleaning filters are applied:

\begin{itemize}
\item The {\tt EcalDeadCellTriggerPrimitiveFilter}, which removes events where dead cells in the
ECAL produce anomalous activity.
\item The {\tt hcalLaserEventFilter}, which removes events where the HCAL laser produces anomalous
activity.
\item The {\tt hcalLaserEventFilter2012}, 
\item The {\tt trackingFailureFilter}, which removes events where the tracking algorithm does not
perform properly.
\item The {\tt CSCTightHaloFilter}, which removes events contaminated by beam halo.
\item The {\tt HBHENoiseFilter}, which removes events featuring large hadronic calorimeter noise.
\item The {\tt eeBadScFilter}, which removes events featuring high amplitude anomalous pulses due
to bad ECAL super-crystals.
\item The {\tt trkPOGFilters}, which remove events due to track reconstruction anomalies, such as
events with partly aborted track reconstruction and events affected by the Strip Tracker coherent
noise.
\item The {\tt primaryVertexFilter}, which removes events that do not have a good primary vertex.
\item The {\tt noscrapingFilter}, which removes events with a large multiplicity of low quality
tracks.
\end{itemize}

More details on these filters can be found in Ref.~\cite{metfilters}. The {\tt CSCTightHaloFilter}
and {\tt HBHENoiseFilter} filters are not applied for simulated samples that are
passed through the fast CMS detector simulation because the necessary input collections are
not produced.

In addition to the standard filters listed above, we also use an extra cleaning selection designed
to remove events with spurious HCAL noise originating in the Hadron Outer Calorimeter (HO). 
Energy deposits in the HO are included in the computation of the missing transverse momentum using 
the particle flow algorithm (PFMET), but are not included in the missing transverse energy obtained
from calorimeter information only (CaloMET). 
A selection requiring no substantial discrepancy between PFMET and CaloMET is thus effective at
reducing the contribution of these noisy events. 

We reject events in which the PFMET vector $\VEtmiss(\textrm{PF})$ is flipped with
respect to the CaloMET vector $\VEtmiss(\textrm{CALO})$. 
To accomplish this we compute the absolute value of the difference in polar angle,
 $|\Delta\phi_{\textrm{PF,CALO}}|$, taken in the range $[0,2\pi[$, and defined as
\begin{align}
|\Delta\phi_{\textrm{PF,CALO}}| &= \min \left ( \phi^{\textrm{PF}} - \phi^{\textrm{CALO}},   2\pi -
\phi^{\textrm{PF}} + \phi^{\textrm{CALO}} \right) ,\\
&\textrm{with } \phi^{\textrm{PF}} = \textrm{arctan} \left( \frac{\ETm(\textrm{PF})|_y}
{\ETm(\textrm{PF})|_x} \right) , \\
&\textrm{and } \phi^{\textrm{CALO}} = \textrm{arctan}\left( \frac{\ETm(\textrm{CALO})|_y}
{\ETm(\textrm{CALO})|_x} \right) .
\end{align}
Events for which $|\Delta\phi_{\textrm{PF,CALO}}|$ falls in a 1 radian window centred around $\pi$
are removed. 
\begin{equation}
\bigl| |\Delta\phi_{\textrm{PF,CALO}}| - \pi \bigr| < 1
\label{eqn:dphicut}
\end{equation}


\subsection{Event reweighting \label{sec:event_reweighting}}

The generation and simulation of events are tuned to mimic the data. However, the complete data
taking conditions, in particular the pileup profile, are not fully known before data
taking starts. It is thus impossible to mimic the data in all aspects. 
In addition to this, the event generation itself is also not perfect. For example, event generators
can only compute physics processes up to maximally NLO precision, whereas data contains all orders. 

To correct for some of these imperfections, event reweighting prescriptions have been developed. 
In the next subsections I will cover the reweightings that correct for mismodelling of the pileup
distribution, the initial state radiation (ISR), and the top quark \pt spectrum for the
$t\bar{t}$ simulation.

\input{event_reweighting.tex}
